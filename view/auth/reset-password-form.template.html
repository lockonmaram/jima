<html>
  <h1>Reset Password</h1>

  <div id="status"></div>

  <form id="resetForm" action="{{ .Action }}" method="post">
    <input type="hidden" name="token" value="{{ .Token }}">

    <label>
      New Password:
      <input type="password" id="password" name="password" required minlength="8">
    </label>
    <br>

    <label>
      Confirm Password:
      <input type="password" id="confirmPassword" name="confirm_password" required minlength="8">
    </label>
    <br>

    <p id="errorMsg" style="color:red"></p>

    <button type="submit">Reset Password</button>
  </form>

  <script>
    const form = document.getElementById('resetForm');
    const statusEl = document.getElementById('status');
    const errorMsg = document.getElementById('errorMsg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorMsg.textContent = '';
      statusEl.textContent = '';

      const password = document.getElementById('password').value.trim();
      const confirm  = document.getElementById('confirmPassword').value.trim();

      // client-side check
      if (password !== confirm) {
        errorMsg.textContent = 'Passwords do not match';
        return;
      }

      try {
        const payload = JSON.stringify({
          password: password
        });
        console.log(form.action)
        const res = await fetch(form.action, {
          method: 'POST',
          body: payload
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(text || 'Request failed');
        }

        const data = await res.json();
        statusEl.style.color = 'green';
        statusEl.textContent = data.message || 'Password reset successful!';
        form.reset();
      } catch (err) {
        statusEl.style.color = 'red';
        statusEl.textContent = 'Error: ' + err.message;
      }
    });
  </script>
</html>